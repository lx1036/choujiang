!function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("Turntable",[],function(){return t.Turntable=e()}):t.Turntable=e()}(this,function(t){function e(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)t[i]=s[i]}return t}function s(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function i(t,e){for(var s in e)"href"==s?t.setAttributeNS("http://www.w3.org/1999/xlink",s,e[s]):t.setAttribute(s,e[s]);return t}function n(t,e){return{x:t.x+t.r*Math.cos(e*(Math.PI/180)),y:t.y+t.r*Math.sin(e*(Math.PI/180)),degree:e}}function r(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function h(t,e,s,i){var n=-1*(s*(e.x-t.x)/i-e.x),r=-1*(s*(e.y-t.y)/i-e.y);return{x:n,y:r}}function o(t,e){return t+Math.floor(Math.random()*(e-t+1))}function u(t){if(this.opts=e({},a,t),!this.opts.values)throw Error("values必须要有值");this.center={x:this.opts.size/2,y:this.opts.size/2,r:this.opts.size/2},this.startPoint={x:this.opts.size,y:this.opts.size/2},this.values=this.opts.values,this.count=this.opts.values.length,this.degree=360/this.count,this.container=null,this.svg=null,this.opts.container&&this.draw(this.opts.container)}var a={size:320,textSpace:15,imgSpace:50,speed:5,fastSpeed:10,slowSpeed:5,speedUp:2e3,speedDown:2e3,values:[]};return u.fn=u.prototype={getValueIndexById:function(t){var e=[];return this.values.map(function(s,i){s.id==t&&e.push(i)}),1==e.length?e[0]:e[o(0,e.length-1)]},getValueDegreeByIndex:function(t){return this.values[t].degree},turning:function(){this.turnTotal+=this.turnBase,(this.turnTotal>=360||this.turnTotal<=-360)&&(this.turnTotal=0),this.svg.style.transform="rotate("+-this.turnTotal+"deg)"},turned:function(){return(this.turnTotal>=360||this.turnTotal<=-360)&&(this.turnTotal=0),this.turnTotal+=this.turnBase,parseInt(this.turnTotal,10)==parseInt(this.turnEndDegree)?(cancelAnimationFrame(this.animation),this.svg.style.transform="rotate("+-this.turnTotal+"deg)",this.turnCallback(this.opts.values[this.index]),!1):(this.svg.style.transform="rotate("+-this.turnTotal+"deg)",!0)},turn:function(){this.animation=requestAnimationFrame(function(){this.isTurnStop?this.turned()&&this.turn():(this.turning(),this.turn())}.bind(this))},start:function(){this.turnBase=this.opts.speed,this.turnTotal=0,this.isTurnStop=!1,this.index=null,this.turn(),setTimeout(function(){this.turnBase=this.opts.fastSpeed}.bind(this),this.opts.speedUp)},stop:function(t,e){this.index=this.getValueIndexById(t),this.turnEndDegree=this.getValueDegreeByIndex(this.index),this.turnBase=this.opts.slowSpeed,"function"!=typeof e&&(e=function(){}),this.turnCallback=e,setTimeout(function(){this.turnBase=1,this.isTurnStop=!0}.bind(this),this.opts.speedDown)},"goto":function(t){t<this.values.length&&(this.svg.style.transform="rotate("+-this.values[t].degree+"deg)")},refresh:function(){this.draw(this.container)},draw:function(t){this.container=t;for(var e=i(s("svg"),{width:this.opts.size,height:this.opts.size,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),o=this.degree,u=this.startPoint,a=n(this.center,o),p=0;p<this.values.length;p++){var d=this.values[p];0==p?d.degree=90+this.degree/2:d.degree=this.values[p-1].degree+this.degree,d.degree>=360&&(d.degree=d.degree-360);var l=s("g"),g=[];g.push("M"+this.center.x+", "+this.center.y),g.push("L"+u.x+", "+u.y),g.push("A"+this.center.x+", "+this.center.y),g.push("1 0, 1"),g.push(a.x+", "+a.y),g.push("z");var c=i(s("path"),{fill:d.bg,d:g.join(" ")});l.appendChild(c);var f={x:(a.x+u.x)/2,y:(a.y+u.y)/2},x=r(f,this.center),v=180-(360-2*this.degree)/2/2,m=h(this.center,f,this.opts.textSpace,x),y=[];y.push("rotate("),y.push(v+this.degree*p),y.push(", "+m.x),y.push(", "+m.y),y.push(")");var w=i(s("text"),{x:m.x,y:m.y,"text-anchor":"middle",fill:d.color,transform:y.join("")});if(w.appendChild(document.createTextNode(d.name)),l.appendChild(w),d.img){var T=h(this.center,f,this.opts.imgSpace,x),S=[];S.push("rotate("),S.push(v+this.degree*p),S.push(", "+T.x),S.push(", "+T.y),S.push(") "),S.push("translate("),S.push(-1*(d.img.width/2)),S.push(", "),S.push(-1*(d.img.height/2)),S.push(")");var b=i(s("image"),{width:d.img.width,height:d.img.height,href:d.img.src,x:T.x,y:T.y,transform:S.join("")});l.appendChild(b)}e.appendChild(l),u=a,a=n(this.center,this.degree+this.degree*(p+1))}t.appendChild(e),this.svg=e}},u});